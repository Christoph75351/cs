<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视频播放站</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/video.js/dist/video.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/video.js/dist/video-js.css" rel="stylesheet">
    <style>
        #app { max-width: 800px; margin: auto; padding: 20px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="app">
        <div v-if="!loggedIn">
            <h2>请登录</h2>
            <input v-model="username" placeholder="用户名">
            <input v-model="password" type="password" placeholder="密码">
            <button @click="login">登录</button>
            <p v-if="error">{{ error }}</p>
        </div>
        <div v-else>
            <h2>{{ video.vod_name }}</h2>
            <video id="player" class="video-js vjs-default-skin" controls preload="auto">
                <source :src="video.vod_play_url" type="application/x-mpegURL">
            </video>
        </div>
    </div>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    loggedIn: localStorage.getItem('loggedIn') === 'true',
                    username: '',
                    password: '',
                    error: '',
                    video: {}
                };
            },
            methods: {
                async fetchVideo() {
                    const res = await fetch('videos.json');
                    const videos = await res.json();
                    this.video = videos[0];
                },
                async login() {
                    const res = await fetch('users.json');
                    const users = await res.json();
                    const validUser = users.find(user => user.username === this.username && user.password === this.password);
                    if (validUser) {
                        localStorage.setItem('loggedIn', 'true');
                        this.loggedIn = true;
                    } else {
                        this.error = '用户名或密码错误';
                    }
                }
            },
            async mounted() {
                await this.fetchVideo();
                if (this.loggedIn) {
                    const player = videojs('player');
                    player.ready(function() {
                        this.currentTime(20);
                        this.on('timeupdate', () => {
                            if (!localStorage.getItem('loggedIn') && this.currentTime() >= 50) {
                                this.pause();
                                alert('请登录以继续观看');
                            }
                        });
                    });
                }
            }
        });
        app.mount('#app');
    </script>
</body>
</html>
